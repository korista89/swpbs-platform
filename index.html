<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SW-PBS í†µí•© í”Œë«í¼ - í•™êµ ì°¨ì› ê¸ì •ì  í–‰ë™ì§€ì› ì‹œìŠ¤í…œ</title>
  <link rel="stylesheet" href="assets/css/swpbs-core.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <style>
    /* Additional Dashboard Styles */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--space-4);
      margin-bottom: var(--space-5);
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary), #7c3aed);
      color: white;
      padding: var(--space-5);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: var(--space-2);
    }

    .stat-label {
      font-size: 0.875rem;
      opacity: 0.9;
      font-weight: 600;
    }

    .stat-trend {
      margin-top: var(--space-2);
      font-size: 0.75rem;
      opacity: 0.8;
    }

    .wizard-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .wizard-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-6);
      position: relative;
    }

    .wizard-steps::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--border);
      z-index: 0;
    }

    .wizard-step {
      flex: 1;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .wizard-step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--border);
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      margin: 0 auto var(--space-2);
      transition: var(--transition);
    }

    .wizard-step.active .wizard-step-circle {
      background: var(--primary);
      color: white;
      box-shadow: 0 0 0 4px var(--primary-light);
    }

    .wizard-step.completed .wizard-step-circle {
      background: var(--success);
      color: white;
    }

    .wizard-step-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .wizard-step.active .wizard-step-label {
      color: var(--primary);
    }

    .quick-action-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-3);
    }

    .quick-action-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
    }

    .quick-action-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .quick-action-icon {
      font-size: 2.5rem;
      margin-bottom: var(--space-2);
    }

    .quick-action-title {
      font-weight: 700;
      margin-bottom: var(--space-1);
    }

    .quick-action-desc {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .notification-badge {
      background: var(--danger);
      color: white;
      border-radius: var(--radius-full);
      padding: 2px 6px;
      font-size: 0.625rem;
      font-weight: 700;
      position: relative;
      top: -2px;
      margin-left: var(--space-1);
    }

    .module-section {
      display: none;
    }

    .module-section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .feature-list {
      list-style: none;
    }

    .feature-list li {
      padding: var(--space-2) 0;
      display: flex;
      align-items: start;
      gap: var(--space-2);
    }

    .feature-list li::before {
      content: 'âœ“';
      color: var(--success);
      font-weight: 700;
      flex-shrink: 0;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--space-3);
    }

    .data-table th,
    .data-table td {
      padding: var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .data-table th {
      background: var(--background);
      font-weight: 700;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .data-table tr:hover {
      background: var(--background);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Global Header -->
    <header class="global-header">
      <div class="header-content">
        <div class="header-left">
          <div class="app-logo">
            <div class="app-logo-icon">ğŸ¯</div>
            <span>SW-PBS í†µí•© í”Œë«í¼</span>
          </div>
        </div>
        <nav class="header-nav">
          <div class="header-nav-item active" onclick="showModule('home')">
            <span>ğŸ </span> í™ˆ
          </div>
          <div class="header-nav-item" onclick="showModule('meetings')">
            <span>ğŸ‘¥</span> ì›”ê°„íšŒì˜
          </div>
          <div class="header-nav-item" onclick="showModule('datacenter')">
            <span>ğŸ“Š</span> ë°ì´í„°
          </div>
          <div class="header-nav-item" onclick="showModule('help')">
            <span>â“</span> ì§€ì›
          </div>
          <div class="header-nav-item">
            <span>ğŸ””</span> ì•Œë¦¼
            <span class="notification-badge">3</span>
          </div>
          <div class="header-nav-item">
            <span>ğŸ‘¤</span> ë‚´ ê³„ì •
          </div>
        </nav>
      </div>
    </header>

    <main class="main-content">
      <!-- Role Selector -->
      <div class="role-selector">
        <div class="role-selector-title">ì—­í•  ì„ íƒ</div>
        <div class="role-buttons">
          <button class="role-button active" data-role="admin" onclick="selectRole('admin')">
            <span>ğŸ‘‘</span> ì´ê´„ë‹´ë‹¹
          </button>
          <button class="role-button" data-role="leadership" onclick="selectRole('leadership')">
            <span>â­</span> ë¦¬ë”ì‹­íŒ€ì›
          </button>
          <button class="role-button" data-role="tier2" onclick="selectRole('tier2')">
            <span>ğŸ¯</span> í‘œì ì§‘ë‹¨ ë‹´ë‹¹
          </button>
          <button class="role-button" data-role="tier3" onclick="selectRole('tier3')">
            <span>ğŸ”¬</span> ê°œë³„ì§€ì› ë‹´ë‹¹
          </button>
          <button class="role-button" data-role="teacher" onclick="selectRole('teacher')">
            <span>ğŸ‘¨â€ğŸ«</span> ë‹´ì„êµì‚¬
          </button>
          <button class="role-button" data-role="manager" onclick="selectRole('manager')">
            <span>ğŸ“‹</span> ê´€ë¦¬ì
          </button>
        </div>
      </div>

      <!-- Home Module -->
      <div id="home" class="module-section active">
        <h1>í•™êµ í˜„í™© ëŒ€ì‹œë³´ë“œ</h1>

        <!-- Dashboard Stats -->
        <div class="dashboard-stats">
          <div class="stat-card">
            <div class="stat-value">142</div>
            <div class="stat-label">ì˜¤ëŠ˜ì˜ ODR</div>
            <div class="stat-trend">â–¼ ì „ì£¼ ëŒ€ë¹„ 12% ê°ì†Œ</div>
          </div>

          <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
            <div class="stat-value">85%</div>
            <div class="stat-label">Tier 1 ì¶©ì‹¤ë„ (TFI)</div>
            <div class="stat-trend">ëª©í‘œ: 80% ì´ìƒ</div>
          </div>

          <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
            <div class="stat-value">24</div>
            <div class="stat-label">í‘œì ì§‘ë‹¨ ì§€ì› í•™ìƒ</div>
            <div class="stat-trend">CICO 18ëª…, SST 6ëª…</div>
          </div>

          <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
            <div class="stat-value">8</div>
            <div class="stat-label">ê°œë³„ì§€ì› ëŒ€ìƒ í•™ìƒ</div>
            <div class="stat-trend">FBA/BIP ì§„í–‰ ì¤‘</div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">ë¹ ë¥¸ ì‘ì—…</h3>
          </div>
          <div class="card-body">
            <div class="quick-action-grid">
              <div class="quick-action-card" onclick="showModule('tier1')">
                <div class="quick-action-icon">ğŸ“š</div>
                <div class="quick-action-title">ê¸°ëŒ€í–‰ë™ ê´€ë¦¬</div>
                <div class="quick-action-desc">ë§¤íŠ¸ë¦­ìŠ¤ ë° êµìœ¡ìë£Œ</div>
              </div>

              <div class="quick-action-card" onclick="recordODR()">
                <div class="quick-action-icon">ğŸ“</div>
                <div class="quick-action-title">ODR ê¸°ë¡</div>
                <div class="quick-action-desc">ë¬¸ì œí–‰ë™ ì‚¬ê±´ ì…ë ¥</div>
              </div>

              <div class="quick-action-card" onclick="recordPraise()">
                <div class="quick-action-icon">â­</div>
                <div class="quick-action-title">ì¹­ì°¬ í¬ì¸íŠ¸</div>
                <div class="quick-action-desc">ê¸ì •í–‰ë™ ê°•í™”</div>
              </div>

              <div class="quick-action-card" onclick="showModule('tier2')">
                <div class="quick-action-icon">ğŸ¯</div>
                <div class="quick-action-title">CICO ì²´í¬ì¸</div>
                <div class="quick-action-desc">ì¼ì¼ ì§„ë„ ê¸°ë¡</div>
              </div>

              <div class="quick-action-card" onclick="showModule('tier3')">
                <div class="quick-action-icon">ğŸ”¬</div>
                <div class="quick-action-title">FBA í‰ê°€</div>
                <div class="quick-action-desc">ê¸°ëŠ¥ í‰ê°€ ë„êµ¬</div>
              </div>

              <div class="quick-action-card" onclick="generateReport()">
                <div class="quick-action-icon">ğŸ“Š</div>
                <div class="quick-action-title">ë¦¬í¬íŠ¸ ìƒì„±</div>
                <div class="quick-action-desc">ì›”ê°„/í•™ê¸° ë³´ê³ ì„œ</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Alerts & Notifications -->
        <div class="card mt-4">
          <div class="card-header">
            <h3 class="card-title">âš ï¸ ì¤‘ìš” ì•Œë¦¼</h3>
          </div>
          <div class="card-body">
            <div class="alert alert-warning">
              <span>âš¡</span>
              <div>
                <strong>ë°ì´í„° ì´ìƒì¹˜ ê°ì§€:</strong> ë³µë„ 3ì¸µì—ì„œ ì˜¤ì „ ì‹œê°„ëŒ€ ODRì´ í‰ê·  ëŒ€ë¹„ 200% ì¦ê°€í–ˆìŠµë‹ˆë‹¤.
                í™˜ê²½ ê°œì…ì„ ê²€í† í•˜ì„¸ìš”.
              </div>
            </div>

            <div class="alert alert-info">
              <span>ğŸ“…</span>
              <div>
                <strong>í‘œì ì§‘ë‹¨ ì¬í‰ê°€ ì‹œì :</strong> CICO í”„ë¡œê·¸ë¨ ì°¸ì—¬ í•™ìƒ 6ëª…ì´ 4ì£¼ í‰ê°€ ê¸°ê°„ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤.
              </div>
            </div>

            <div class="alert alert-danger">
              <span>ğŸ“‹</span>
              <div>
                <strong>ìœ„ê¸°í–‰ë™ ë³´ê³ ì„œ ë¯¸ì™„ë£Œ:</strong> 3ê±´ì˜ ë¶„ë¦¬/ë¬¼ë¦¬ì  ê°œì… ë³´ê³ ì„œê°€ ì‘ì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation to Modules -->
        <div class="grid grid-3 mt-4">
          <div class="card" onclick="showModule('tier1')">
            <div class="card-header">
              <h4 class="card-title">
                <span class="tier-badge tier-badge-1">Tier 1</span>
                ë³´í¸ì  ì§€ì›
              </h4>
            </div>
            <div class="card-body">
              <ul class="feature-list">
                <li>ê¸°ëŒ€í–‰ë™ ë§¤íŠ¸ë¦­ìŠ¤ êµ¬ì¶•</li>
                <li>ODR/ê²½ë¯¸ì‚¬ê±´ ê´€ë¦¬</li>
                <li>ì¹­ì°¬ í¬ì¸íŠ¸ ì‹œìŠ¤í…œ</li>
                <li>í™˜ê²½ ë° ì ˆì°¨ ì„¤ì •</li>
              </ul>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary">ì‹œì‘í•˜ê¸° â†’</button>
            </div>
          </div>

          <div class="card" onclick="showModule('tier2')">
            <div class="card-header">
              <h4 class="card-title">
                <span class="tier-badge tier-badge-2">Tier 2</span>
                í‘œì ì§‘ë‹¨ ì§€ì›
              </h4>
            </div>
            <div class="card-body">
              <ul class="feature-list">
                <li>CICO í”„ë¡œê·¸ë¨ ìš´ì˜</li>
                <li>SST & FCT ì„¸ì…˜</li>
                <li>í•™ìƒ ì‹ë³„ ë° ë°°ì¹˜</li>
                <li>ë°˜ì‘ ê¸°ë°˜ ì˜ì‚¬ê²°ì •</li>
              </ul>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary">ì‹œì‘í•˜ê¸° â†’</button>
            </div>
          </div>

          <div class="card" onclick="showModule('tier3')">
            <div class="card-header">
              <h4 class="card-title">
                <span class="tier-badge tier-badge-3">Tier 3</span>
                ê°œë³„í•™ìƒ ì§€ì›
              </h4>
            </div>
            <div class="card-body">
              <ul class="feature-list">
                <li>FBA í‰ê°€ ë„êµ¬</li>
                <li>BIP ê³„íš ìˆ˜ë¦½</li>
                <li>ëª©í‘œ-ê¸°ì¤€ì„  ì¶”ì </li>
                <li>ìœ„ê¸°ì˜ˆë°© ë° ëŒ€ì‘</li>
              </ul>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary">ì‹œì‘í•˜ê¸° â†’</button>
            </div>
          </div>
        </div>
      </div>

      <!-- ì—¬ê¸°ì— ë‹¤ë¥¸ ëª¨ë“ˆë“¤ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
      <div id="tier1" class="module-section"></div>
      <div id="tier2" class="module-section"></div>
      <div id="tier3" class="module-section"></div>
      <div id="meetings" class="module-section"></div>
      <div id="datacenter" class="module-section"></div>
      <div id="help" class="module-section"></div>

    </main>

    <footer style="text-align: center; padding: var(--space-5); color: var(--text-secondary); font-size: 0.875rem;">
      <p>Â© 2025 SW-PBS í†µí•© í”Œë«í¼ â€¢ Positive Behavior Support â€¢ ê²½ì€í•™êµ</p>
      <p style="margin-top: var(--space-2); font-size: 0.75rem;">
        Based on PBIS Implementation Blueprint 4.0, TFI 3.0/2.1, SWIS Suite Integration
      </p>
    </footer>
  </div>

  <script src="assets/js/swpbs-core.js"></script>
  <script src="assets/js/sample-data-generator.js"></script>
  <script src="modules/onboarding-wizard.js"></script>
  <script src="modules/tier1-module.js"></script>
  <script src="modules/tier2-module.js"></script>
  <script src="modules/tier3-module.js"></script>
  <script src="modules/datacenter-module.js"></script>
  <script src="modules/meetings-module.js"></script>

  <script>
    // Initialize modules when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('ğŸš€ Initializing SW-PBS Platform...');

      // Check if core modules are loaded
      const requiredModules = [
        'SWPBS',
        'DataManager',
        'ChartManager',
        'UIManager',
        'AnalyticsEngine',
        'SampleDataGenerator',
        'OnboardingWizard',
        'Tier1Module',
        'Tier2Module',
        'Tier3Module',
        'DataCenterModule',
        'MeetingsModule'
      ];

      const missingModules = requiredModules.filter(mod => typeof window[mod] === 'undefined');

      if (missingModules.length > 0) {
        console.error('âŒ Missing modules:', missingModules);
        alert('ì¼ë¶€ ëª¨ë“ˆì„ ë¡œë“œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.\n\nëˆ„ë½ëœ ëª¨ë“ˆ: ' + missingModules.join(', '));
        return;
      }

      console.log('âœ… All modules loaded successfully');

      try {
        // Initialize onboarding wizard first
        if (typeof OnboardingWizard !== 'undefined') {
          OnboardingWizard.initialize();
          console.log('âœ… Onboarding initialized');
        }

        // Initialize all modules
        if (typeof Tier1Module !== 'undefined') {
          Tier1Module.initialize();
          console.log('âœ… Tier1Module initialized');
        }

        if (typeof Tier2Module !== 'undefined') {
          Tier2Module.initialize();
          console.log('âœ… Tier2Module initialized');
        }

        if (typeof Tier3Module !== 'undefined') {
          Tier3Module.initialize();
          console.log('âœ… Tier3Module initialized');
        }

        if (typeof DataCenterModule !== 'undefined') {
          DataCenterModule.initialize();
          console.log('âœ… DataCenterModule initialized');
        }

        if (typeof MeetingsModule !== 'undefined') {
          MeetingsModule.initialize();
          console.log('âœ… MeetingsModule initialized');
        }

        // Load sample data for demonstration
        loadSampleData();

        console.log('ğŸ‰ SW-PBS Platform initialized successfully!');
      } catch (error) {
        console.error('âŒ Initialization error:', error);
        alert('í”Œë«í¼ ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n\n' + error.message + '\n\ní˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.');
      }
    });

    // Load sample data based on data1024.csv structure
    function loadSampleData() {
      // Check if data already exists in localStorage
      const existingData = localStorage.getItem('swpbs_data');
      if (existingData) {
        console.log('ğŸ“¦ Loading existing data from localStorage');
        DataManager.loadFromLocalStorage();
        UIManager.updateDashboard();
        return;
      }

      console.log('ğŸ² Generating comprehensive sample data...');

      // Generate complete dataset using SampleDataGenerator
      const dataset = SampleDataGenerator.generateCompleteDataset();

      // Convert ODR data to internal format
      SWPBS.data.odrEvents = dataset.odrData.map((row, index) => ({
        id: `odr_${Date.now()}_${index}`,
        date: row['í–‰ë™ ë°œìƒì¼'],
        time: row['ë°œìƒ ì‹œê°„ëŒ€'],
        weekday: row['ë°œìƒ ìš”ì¼'],
        studentName: row['í•™ìƒëª…'],
        behavior: row['ë°œìƒí•œ ìœ„ê¸°í–‰ë™'],
        intensity: parseInt(row['ê°•ë„or5ì  ì²™ë„']),
        function: row['ì¶”ì •ë˜ëŠ” ê¸°ëŠ¥(ë™ê¸°)'],
        location: row['í–‰ë™ ë°œìƒ ì¥ì†Œ'],
        tier: row['í˜„ì¬ì§€ì›ë‹¨ê³„'],
        teacher: row['ì…ë ¥ êµì‚¬ëª…'],
        notes: row['íŠ¹ì´ì‚¬í•­'],
        antecedent: row['ì£¼ìš”ì„ í–‰ì‚¬ê±´'],
        consequence: row['ì£¼ìš”í›„ì†ê²°ê³¼'],
        week: row['ë°œìƒ ì£¼ì°¨']
      }));

      // Load praise points
      SWPBS.data.praisePoints = dataset.praiseData;

      // Load CICO records
      SWPBS.data.cicoRecords = dataset.cicoData;

      // Load FBA assessments
      SWPBS.data.fbaAssessments = dataset.fbaData;

      // Load BIP plans
      SWPBS.data.bipPlans = dataset.bipData;

      // Load meetings
      SWPBS.data.meetings = dataset.meetingData;

      // Extract unique students
      const studentNames = [...new Set(dataset.odrData.map(row => row['í•™ìƒëª…']))];
      SWPBS.data.students = studentNames.map(name => {
        const studentEvents = SWPBS.data.odrEvents.filter(e => e.studentName === name);
        const avgIntensity = studentEvents.length > 0
          ? studentEvents.reduce((sum, e) => sum + e.intensity, 0) / studentEvents.length
          : 0;

        let tier = 'Tier 1';
        if (avgIntensity >= 4 || studentEvents.length >= 8) tier = 'Tier 3';
        else if (avgIntensity >= 3 || studentEvents.length >= 4) tier = 'Tier 2';

        // Check if student has CICO or BIP
        const hasCICO = SWPBS.data.cicoRecords.some(r => r.studentName === name);
        const hasBIP = SWPBS.data.bipPlans.some(b => b.studentName === name);
        const hasFBA = SWPBS.data.fbaAssessments.some(f => f.studentName === name);

        const interventions = [];
        if (hasCICO) interventions.push('CICO');
        if (hasFBA) interventions.push('FBA');
        if (hasBIP) interventions.push('BIP');

        return {
          id: `student_${name}`,
          name: name,
          grade: Math.floor(Math.random() * 6) + 1,
          class: Math.floor(Math.random() * 4) + 1,
          tier: tier,
          odrCount: studentEvents.length,
          lastODR: studentEvents[0]?.date || '',
          status: 'active',
          interventions: interventions
        };
      });

      // Initialize TFI scores
      SWPBS.data.tfiScores = {
        tier1: {
          teams: 85,
          implementation: 80,
          evaluation: 75,
          total: 80
        },
        tier2: {
          teams: 70,
          implementation: 65,
          evaluation: 60,
          total: 65
        },
        tier3: {
          teams: 60,
          implementation: 55,
          evaluation: 50,
          total: 55
        }
      };

      // Initialize SAS scores
      SWPBS.data.sasScores = {
        expectations: 4.2,
        training: 3.8,
        monitoring: 4.0,
        recognition: 4.5,
        discipline: 3.9,
        overall: 4.08
      };

      // Save to localStorage
      DataManager.saveToLocalStorage();

      // Update dashboard
      UIManager.updateDashboard();

      console.log('âœ… Sample data loaded successfully');
    }

    // Global helper functions for quick actions
    function recordODR() {
      showModule('tier1');
      // Auto-click the data tab after a short delay
      setTimeout(() => {
        const dataTab = document.querySelector('[data-tier1-tab="data"]');
        if (dataTab) dataTab.click();
      }, 300);
    }

    function recordPraise() {
      showModule('tier1');
      setTimeout(() => {
        const rewardsTab = document.querySelector('[data-tier1-tab="rewards"]');
        if (rewardsTab) rewardsTab.click();
      }, 300);
    }

    function generateReport() {
      showModule('datacenter');
      setTimeout(() => {
        const reportsTab = document.querySelector('[data-datacenter-tab="reports"]');
        if (reportsTab) reportsTab.click();
      }, 300);
    }

    // Update showModule to render module content
    function showModule(moduleId) {
      console.log('ğŸ”„ Switching to module:', moduleId);

      // Hide all modules
      document.querySelectorAll('.module-section').forEach(section => {
        section.classList.remove('active');
      });

      // Show selected module
      const moduleSection = document.getElementById(moduleId);
      if (!moduleSection) {
        console.error('âŒ Module section not found:', moduleId);
        return;
      }

      moduleSection.classList.add('active');

      // Render module content
      try {
        switch(moduleId) {
          case 'tier1':
            if (typeof Tier1Module === 'undefined') {
              throw new Error('Tier1Module not loaded');
            }
            moduleSection.innerHTML = Tier1Module.render();
            Tier1Module.initializeCharts();
            Tier1Module.attachEventListeners();
            console.log('âœ… Tier 1 module rendered');
            break;

          case 'tier2':
            if (typeof Tier2Module === 'undefined') {
              throw new Error('Tier2Module not loaded');
            }
            moduleSection.innerHTML = Tier2Module.render();
            Tier2Module.initializeCharts();
            Tier2Module.attachEventListeners();
            console.log('âœ… Tier 2 module rendered');
            break;

          case 'tier3':
            if (typeof Tier3Module === 'undefined') {
              throw new Error('Tier3Module not loaded');
            }
            moduleSection.innerHTML = Tier3Module.render();
            Tier3Module.initializeCharts();
            Tier3Module.attachEventListeners();
            console.log('âœ… Tier 3 module rendered');
            break;

          case 'datacenter':
            if (typeof DataCenterModule === 'undefined') {
              throw new Error('DataCenterModule not loaded');
            }
            moduleSection.innerHTML = DataCenterModule.render();
            DataCenterModule.attachEventListeners();
            console.log('âœ… DataCenter module rendered');
            break;

          case 'meetings':
            if (typeof MeetingsModule === 'undefined') {
              throw new Error('MeetingsModule not loaded');
            }
            moduleSection.innerHTML = MeetingsModule.render();
            MeetingsModule.initializeCharts();
            MeetingsModule.attachEventListeners();
            console.log('âœ… Meetings module rendered');
            break;

          case 'help':
            moduleSection.innerHTML = renderHelpModule();
            console.log('âœ… Help module rendered');
            break;

          case 'home':
            console.log('âœ… Home module (already rendered)');
            break;

          default:
            console.warn('âš ï¸ Unknown module:', moduleId);
        }
      } catch (error) {
        console.error('âŒ Error rendering module:', moduleId, error);
        moduleSection.innerHTML = `
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">âš ï¸ ëª¨ë“ˆ ë¡œë“œ ì˜¤ë¥˜</h3>
            </div>
            <div class="card-body">
              <div class="alert alert-danger">
                <span>âŒ</span>
                <div>
                  <strong>ëª¨ë“ˆì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:</strong> ${moduleId}<br>
                  <small>ì˜¤ë¥˜: ${error.message}</small><br>
                  <small>í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨(F5)í•´ë³´ì„¸ìš”.</small>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      // Update header nav
      document.querySelectorAll('.header-nav-item').forEach(item => {
        item.classList.remove('active');
      });

      // Update UI state if SWPBS is available
      if (typeof SWPBS !== 'undefined') {
        SWPBS.ui.currentModule = moduleId;
      }
    }

    // Update selectRole function
    function selectRole(role) {
      SWPBS.user.role = role;

      // Update role buttons
      document.querySelectorAll('.role-button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.role === role) {
          btn.classList.add('active');
        }
      });

      // Set permissions based on role
      const permissions = {
        admin: ['all'],
        leadership: ['tier1', 'tier2', 'tier3', 'meetings', 'datacenter'],
        tier2: ['tier1', 'tier2', 'datacenter'],
        tier3: ['tier1', 'tier3', 'datacenter'],
        teacher: ['tier1', 'datacenter'],
        manager: ['datacenter', 'meetings']
      };

      SWPBS.user.permissions = permissions[role] || [];

      // Show notification
      UIManager.showNotification(`${getRoleName(role)} ì—­í• ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤`, 'success');
    }

    function getRoleName(role) {
      const roleNames = {
        admin: 'ì´ê´„ë‹´ë‹¹',
        leadership: 'ë¦¬ë”ì‹­íŒ€ì›',
        tier2: 'í‘œì ì§‘ë‹¨ ë‹´ë‹¹',
        tier3: 'ê°œë³„ì§€ì› ë‹´ë‹¹',
        teacher: 'ë‹´ì„êµì‚¬',
        manager: 'ê´€ë¦¬ì'
      };
      return roleNames[role] || role;
    }

    // Help module content
    function renderHelpModule() {
      return `
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">â“ ì‚¬ìš©ì ê°€ì´ë“œ</h2>
          </div>
          <div class="card-body">
            <div class="grid grid-2">
              <div>
                <h3>ì‹œì‘í•˜ê¸°</h3>
                <ul class="feature-list">
                  <li><strong>ì—­í•  ì„ íƒ:</strong> ìƒë‹¨ì˜ ì—­í•  ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê·€í•˜ì˜ ì—­í• ì„ ì„ íƒí•˜ì„¸ìš”</li>
                  <li><strong>ë°ì´í„° ì—…ë¡œë“œ:</strong> ë°ì´í„°ì„¼í„°ì—ì„œ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</li>
                  <li><strong>ODR ê¸°ë¡:</strong> Tier 1 ëª¨ë“ˆì—ì„œ ë¬¸ì œí–‰ë™ ì‚¬ê±´ì„ ê¸°ë¡í•˜ì„¸ìš”</li>
                  <li><strong>í•™ìƒ ë°°ì¹˜:</strong> Tier 2/3 ëª¨ë“ˆì—ì„œ ê°œì… í”„ë¡œê·¸ë¨ì— í•™ìƒì„ ë°°ì¹˜í•˜ì„¸ìš”</li>
                </ul>

                <h3 class="mt-4">ì£¼ìš” ê¸°ëŠ¥</h3>
                <ul class="feature-list">
                  <li><strong>Tier 1:</strong> ë³´í¸ì  ì§€ì› - ê¸°ëŒ€í–‰ë™, ODR ê´€ë¦¬, ì¹­ì°¬ í¬ì¸íŠ¸</li>
                  <li><strong>Tier 2:</strong> í‘œì ì§‘ë‹¨ - CICO, SST, FCT í”„ë¡œê·¸ë¨</li>
                  <li><strong>Tier 3:</strong> ê°œë³„ì§€ì› - FBA í‰ê°€, BIP ê³„íš, ìœ„ê¸°ê´€ë¦¬</li>
                  <li><strong>ë°ì´í„°ì„¼í„°:</strong> CSV ì—…ë¡œë“œ, ì¿¼ë¦¬ ë¹Œë”, ë³´ê³ ì„œ ìƒì„±</li>
                  <li><strong>íšŒì˜:</strong> ë¦¬ë”ì‹­ ë¯¸íŒ…, TFI í‰ê°€, ì‹¤í–‰ê³¼ì œ ì¶”ì </li>
                </ul>
              </div>

              <div>
                <h3>CSV íŒŒì¼ í˜•ì‹</h3>
                <p>ë‹¤ìŒ ì»¬ëŸ¼ì„ í¬í•¨í•œ CSV íŒŒì¼ì„ ì—…ë¡œë“œí•˜ì„¸ìš”:</p>
                <ul class="feature-list">
                  <li>í–‰ë™ ë°œìƒì¼ (YYYY-MM-DD)</li>
                  <li>ë°œìƒ ì‹œê°„ëŒ€ (ì˜¤ì „/ì˜¤í›„)</li>
                  <li>í•™ìƒëª…</li>
                  <li>ë°œìƒí•œ ìœ„ê¸°í–‰ë™</li>
                  <li>ê°•ë„or5ì  ì²™ë„ (1-5)</li>
                  <li>ì¶”ì •ë˜ëŠ” ê¸°ëŠ¥(ë™ê¸°)</li>
                  <li>í–‰ë™ ë°œìƒ ì¥ì†Œ</li>
                  <li>í˜„ì¬ì§€ì›ë‹¨ê³„ (Tier 1/2/3)</li>
                  <li>ê¸°íƒ€ ì„ íƒ í•„ë“œ</li>
                </ul>

                <h3 class="mt-4">ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</h3>
                <div class="alert alert-info">
                  <strong>Q: ë°ì´í„°ëŠ” ì–´ë””ì— ì €ì¥ë˜ë‚˜ìš”?</strong><br>
                  A: ëª¨ë“  ë°ì´í„°ëŠ” ë¸Œë¼ìš°ì €ì˜ localStorageì— ì•ˆì „í•˜ê²Œ ì €ì¥ë©ë‹ˆë‹¤.
                </div>

                <div class="alert alert-info">
                  <strong>Q: TFI ì ìˆ˜ëŠ” ì–´ë–»ê²Œ ê³„ì‚°í•˜ë‚˜ìš”?</strong><br>
                  A: íšŒì˜ ëª¨ë“ˆì˜ TFI íƒ­ì—ì„œ ê° í•­ëª©ì„ í‰ê°€í•˜ë©´ ìë™ìœ¼ë¡œ ê³„ì‚°ë©ë‹ˆë‹¤.
                </div>

                <div class="alert alert-info">
                  <strong>Q: í•™ìƒì€ ì–¸ì œ Tier 2/3ë¡œ ë°°ì¹˜í•˜ë‚˜ìš”?</strong><br>
                  A: ODR ë¹ˆë„ì™€ ê°•ë„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ ì¶”ì²œë˜ë©°, íŒ€ íšŒì˜ì—ì„œ ìµœì¢… ê²°ì •í•©ë‹ˆë‹¤.
                </div>
              </div>
            </div>

            <div class="mt-4" style="text-align: center; padding: var(--space-5); background: var(--background); border-radius: var(--radius-lg);">
              <h3>ê¸°ìˆ  ì§€ì›</h3>
              <p>ë¬¸ì˜ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ swpbs-support@school.eduë¡œ ì—°ë½ì£¼ì„¸ìš”</p>
              <button class="btn btn-primary mt-3" onclick="window.open('https://github.com', '_blank')">
                ğŸ“š ì „ì²´ ì‚¬ìš©ì ë§¤ë‰´ì–¼ ë³´ê¸°
              </button>
            </div>
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>
