<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SW-PBS 통합 플랫폼 - 학교 차원 긍정적 행동지원 시스템</title>
  <link rel="stylesheet" href="assets/css/swpbs-core.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
  <style>
    /* Additional Dashboard Styles */
    .dashboard-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: var(--space-4);
      margin-bottom: var(--space-5);
    }

    .stat-card {
      background: linear-gradient(135deg, var(--primary), #7c3aed);
      color: white;
      padding: var(--space-5);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg);
    }

    .stat-value {
      font-size: 2.5rem;
      font-weight: 800;
      margin-bottom: var(--space-2);
    }

    .stat-label {
      font-size: 0.875rem;
      opacity: 0.9;
      font-weight: 600;
    }

    .stat-trend {
      margin-top: var(--space-2);
      font-size: 0.75rem;
      opacity: 0.8;
    }

    .wizard-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .wizard-steps {
      display: flex;
      justify-content: space-between;
      margin-bottom: var(--space-6);
      position: relative;
    }

    .wizard-steps::before {
      content: '';
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--border);
      z-index: 0;
    }

    .wizard-step {
      flex: 1;
      text-align: center;
      position: relative;
      z-index: 1;
    }

    .wizard-step-circle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--border);
      color: var(--text-secondary);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      margin: 0 auto var(--space-2);
      transition: var(--transition);
    }

    .wizard-step.active .wizard-step-circle {
      background: var(--primary);
      color: white;
      box-shadow: 0 0 0 4px var(--primary-light);
    }

    .wizard-step.completed .wizard-step-circle {
      background: var(--success);
      color: white;
    }

    .wizard-step-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-secondary);
    }

    .wizard-step.active .wizard-step-label {
      color: var(--primary);
    }

    .quick-action-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-3);
    }

    .quick-action-card {
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: var(--radius-lg);
      padding: var(--space-4);
      cursor: pointer;
      transition: var(--transition);
      text-align: center;
    }

    .quick-action-card:hover {
      border-color: var(--primary);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .quick-action-icon {
      font-size: 2.5rem;
      margin-bottom: var(--space-2);
    }

    .quick-action-title {
      font-weight: 700;
      margin-bottom: var(--space-1);
    }

    .quick-action-desc {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .notification-badge {
      background: var(--danger);
      color: white;
      border-radius: var(--radius-full);
      padding: 2px 6px;
      font-size: 0.625rem;
      font-weight: 700;
      position: relative;
      top: -2px;
      margin-left: var(--space-1);
    }

    .module-section {
      display: none;
    }

    .module-section.active {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .feature-list {
      list-style: none;
    }

    .feature-list li {
      padding: var(--space-2) 0;
      display: flex;
      align-items: start;
      gap: var(--space-2);
    }

    .feature-list li::before {
      content: '✓';
      color: var(--success);
      font-weight: 700;
      flex-shrink: 0;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: var(--space-3);
    }

    .data-table th,
    .data-table td {
      padding: var(--space-3);
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .data-table th {
      background: var(--background);
      font-weight: 700;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .data-table tr:hover {
      background: var(--background);
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Global Header -->
    <header class="global-header">
      <div class="header-content">
        <div class="header-left">
          <div class="app-logo">
            <div class="app-logo-icon">🎯</div>
            <span>SW-PBS 통합 플랫폼</span>
          </div>
        </div>
        <nav class="header-nav">
          <div class="header-nav-item active" onclick="showModule('home')">
            <span>🏠</span> 홈
          </div>
          <div class="header-nav-item" onclick="showModule('meetings')">
            <span>👥</span> 월간회의
          </div>
          <div class="header-nav-item" onclick="showModule('datacenter')">
            <span>📊</span> 데이터
          </div>
          <div class="header-nav-item" onclick="showModule('help')">
            <span>❓</span> 지원
          </div>
          <div class="header-nav-item">
            <span>🔔</span> 알림
            <span class="notification-badge">3</span>
          </div>
          <div class="header-nav-item">
            <span>👤</span> 내 계정
          </div>
        </nav>
      </div>
    </header>

    <main class="main-content">
      <!-- Role Selector -->
      <div class="role-selector">
        <div class="role-selector-title">역할 선택</div>
        <div class="role-buttons">
          <button class="role-button active" data-role="admin" onclick="selectRole('admin')">
            <span>👑</span> 총괄담당
          </button>
          <button class="role-button" data-role="leadership" onclick="selectRole('leadership')">
            <span>⭐</span> 리더십팀원
          </button>
          <button class="role-button" data-role="tier2" onclick="selectRole('tier2')">
            <span>🎯</span> 표적집단 담당
          </button>
          <button class="role-button" data-role="tier3" onclick="selectRole('tier3')">
            <span>🔬</span> 개별지원 담당
          </button>
          <button class="role-button" data-role="teacher" onclick="selectRole('teacher')">
            <span>👨‍🏫</span> 담임교사
          </button>
          <button class="role-button" data-role="manager" onclick="selectRole('manager')">
            <span>📋</span> 관리자
          </button>
        </div>
      </div>

      <!-- Home Module -->
      <div id="home" class="module-section active">
        <h1>학교 현황 대시보드</h1>

        <!-- Dashboard Stats -->
        <div class="dashboard-stats">
          <div class="stat-card">
            <div class="stat-value">142</div>
            <div class="stat-label">오늘의 ODR</div>
            <div class="stat-trend">▼ 전주 대비 12% 감소</div>
          </div>

          <div class="stat-card" style="background: linear-gradient(135deg, #10b981, #059669);">
            <div class="stat-value">85%</div>
            <div class="stat-label">Tier 1 충실도 (TFI)</div>
            <div class="stat-trend">목표: 80% 이상</div>
          </div>

          <div class="stat-card" style="background: linear-gradient(135deg, #f59e0b, #d97706);">
            <div class="stat-value">24</div>
            <div class="stat-label">표적집단 지원 학생</div>
            <div class="stat-trend">CICO 18명, SST 6명</div>
          </div>

          <div class="stat-card" style="background: linear-gradient(135deg, #ef4444, #dc2626);">
            <div class="stat-value">8</div>
            <div class="stat-label">개별지원 대상 학생</div>
            <div class="stat-trend">FBA/BIP 진행 중</div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">빠른 작업</h3>
          </div>
          <div class="card-body">
            <div class="quick-action-grid">
              <div class="quick-action-card" onclick="showModule('tier1')">
                <div class="quick-action-icon">📚</div>
                <div class="quick-action-title">기대행동 관리</div>
                <div class="quick-action-desc">매트릭스 및 교육자료</div>
              </div>

              <div class="quick-action-card" onclick="recordODR()">
                <div class="quick-action-icon">📝</div>
                <div class="quick-action-title">ODR 기록</div>
                <div class="quick-action-desc">문제행동 사건 입력</div>
              </div>

              <div class="quick-action-card" onclick="recordPraise()">
                <div class="quick-action-icon">⭐</div>
                <div class="quick-action-title">칭찬 포인트</div>
                <div class="quick-action-desc">긍정행동 강화</div>
              </div>

              <div class="quick-action-card" onclick="showModule('tier2')">
                <div class="quick-action-icon">🎯</div>
                <div class="quick-action-title">CICO 체크인</div>
                <div class="quick-action-desc">일일 진도 기록</div>
              </div>

              <div class="quick-action-card" onclick="showModule('tier3')">
                <div class="quick-action-icon">🔬</div>
                <div class="quick-action-title">FBA 평가</div>
                <div class="quick-action-desc">기능 평가 도구</div>
              </div>

              <div class="quick-action-card" onclick="generateReport()">
                <div class="quick-action-icon">📊</div>
                <div class="quick-action-title">리포트 생성</div>
                <div class="quick-action-desc">월간/학기 보고서</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Alerts & Notifications -->
        <div class="card mt-4">
          <div class="card-header">
            <h3 class="card-title">⚠️ 중요 알림</h3>
          </div>
          <div class="card-body">
            <div class="alert alert-warning">
              <span>⚡</span>
              <div>
                <strong>데이터 이상치 감지:</strong> 복도 3층에서 오전 시간대 ODR이 평균 대비 200% 증가했습니다.
                환경 개입을 검토하세요.
              </div>
            </div>

            <div class="alert alert-info">
              <span>📅</span>
              <div>
                <strong>표적집단 재평가 시점:</strong> CICO 프로그램 참여 학생 6명이 4주 평가 기간에 도달했습니다.
              </div>
            </div>

            <div class="alert alert-danger">
              <span>📋</span>
              <div>
                <strong>위기행동 보고서 미완료:</strong> 3건의 분리/물리적 개입 보고서가 작성되지 않았습니다.
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation to Modules -->
        <div class="grid grid-3 mt-4">
          <div class="card" onclick="showModule('tier1')">
            <div class="card-header">
              <h4 class="card-title">
                <span class="tier-badge tier-badge-1">Tier 1</span>
                보편적 지원
              </h4>
            </div>
            <div class="card-body">
              <ul class="feature-list">
                <li>기대행동 매트릭스 구축</li>
                <li>ODR/경미사건 관리</li>
                <li>칭찬 포인트 시스템</li>
                <li>환경 및 절차 설정</li>
              </ul>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary">시작하기 →</button>
            </div>
          </div>

          <div class="card" onclick="showModule('tier2')">
            <div class="card-header">
              <h4 class="card-title">
                <span class="tier-badge tier-badge-2">Tier 2</span>
                표적집단 지원
              </h4>
            </div>
            <div class="card-body">
              <ul class="feature-list">
                <li>CICO 프로그램 운영</li>
                <li>SST & FCT 세션</li>
                <li>학생 식별 및 배치</li>
                <li>반응 기반 의사결정</li>
              </ul>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary">시작하기 →</button>
            </div>
          </div>

          <div class="card" onclick="showModule('tier3')">
            <div class="card-header">
              <h4 class="card-title">
                <span class="tier-badge tier-badge-3">Tier 3</span>
                개별학생 지원
              </h4>
            </div>
            <div class="card-body">
              <ul class="feature-list">
                <li>FBA 평가 도구</li>
                <li>BIP 계획 수립</li>
                <li>목표-기준선 추적</li>
                <li>위기예방 및 대응</li>
              </ul>
            </div>
            <div class="card-footer">
              <button class="btn btn-primary">시작하기 →</button>
            </div>
          </div>
        </div>
      </div>

      <!-- 여기에 다른 모듈들이 추가됩니다 -->
      <div id="tier1" class="module-section"></div>
      <div id="tier2" class="module-section"></div>
      <div id="tier3" class="module-section"></div>
      <div id="meetings" class="module-section"></div>
      <div id="datacenter" class="module-section"></div>
      <div id="help" class="module-section"></div>

    </main>

    <footer style="text-align: center; padding: var(--space-5); color: var(--text-secondary); font-size: 0.875rem;">
      <p>© 2025 SW-PBS 통합 플랫폼 • Positive Behavior Support • 경은학교</p>
      <p style="margin-top: var(--space-2); font-size: 0.75rem;">
        Based on PBIS Implementation Blueprint 4.0, TFI 3.0/2.1, SWIS Suite Integration
      </p>
    </footer>
  </div>

  <script src="assets/js/swpbs-core.js"></script>
  <script src="assets/js/sample-data-generator.js"></script>
  <script src="modules/onboarding-wizard.js"></script>
  <script src="modules/tier1-module.js"></script>
  <script src="modules/tier2-module.js"></script>
  <script src="modules/tier3-module.js"></script>
  <script src="modules/datacenter-module.js"></script>
  <script src="modules/meetings-module.js"></script>

  <script>
    // Initialize modules when page loads
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Initializing SW-PBS Platform...');

      // Check if core modules are loaded
      const requiredModules = [
        'SWPBS',
        'DataManager',
        'ChartManager',
        'UIManager',
        'AnalyticsEngine',
        'SampleDataGenerator',
        'OnboardingWizard',
        'Tier1Module',
        'Tier2Module',
        'Tier3Module',
        'DataCenterModule',
        'MeetingsModule'
      ];

      const missingModules = requiredModules.filter(mod => typeof window[mod] === 'undefined');

      if (missingModules.length > 0) {
        console.error('❌ Missing modules:', missingModules);
        alert('일부 모듈을 로드하지 못했습니다. 페이지를 새로고침해주세요.\n\n누락된 모듈: ' + missingModules.join(', '));
        return;
      }

      console.log('✅ All modules loaded successfully');

      try {
        // Initialize onboarding wizard first
        if (typeof OnboardingWizard !== 'undefined') {
          OnboardingWizard.initialize();
          console.log('✅ Onboarding initialized');
        }

        // Initialize all modules
        if (typeof Tier1Module !== 'undefined') {
          Tier1Module.initialize();
          console.log('✅ Tier1Module initialized');
        }

        if (typeof Tier2Module !== 'undefined') {
          Tier2Module.initialize();
          console.log('✅ Tier2Module initialized');
        }

        if (typeof Tier3Module !== 'undefined') {
          Tier3Module.initialize();
          console.log('✅ Tier3Module initialized');
        }

        if (typeof DataCenterModule !== 'undefined') {
          DataCenterModule.initialize();
          console.log('✅ DataCenterModule initialized');
        }

        if (typeof MeetingsModule !== 'undefined') {
          MeetingsModule.initialize();
          console.log('✅ MeetingsModule initialized');
        }

        // Load sample data for demonstration
        loadSampleData();

        console.log('🎉 SW-PBS Platform initialized successfully!');
      } catch (error) {
        console.error('❌ Initialization error:', error);
        alert('플랫폼 초기화 중 오류가 발생했습니다:\n\n' + error.message + '\n\n페이지를 새로고침해주세요.');
      }
    });

    // Load sample data based on data1024.csv structure
    function loadSampleData() {
      // Check if data already exists in localStorage
      const existingData = localStorage.getItem('swpbs_data');
      if (existingData) {
        console.log('📦 Loading existing data from localStorage');
        DataManager.loadFromLocalStorage();
        UIManager.updateDashboard();
        return;
      }

      console.log('🎲 Generating comprehensive sample data...');

      // Generate complete dataset using SampleDataGenerator
      const dataset = SampleDataGenerator.generateCompleteDataset();

      // Convert ODR data to internal format
      SWPBS.data.odrEvents = dataset.odrData.map((row, index) => ({
        id: `odr_${Date.now()}_${index}`,
        date: row['행동 발생일'],
        time: row['발생 시간대'],
        weekday: row['발생 요일'],
        studentName: row['학생명'],
        behavior: row['발생한 위기행동'],
        intensity: parseInt(row['강도or5점 척도']),
        function: row['추정되는 기능(동기)'],
        location: row['행동 발생 장소'],
        tier: row['현재지원단계'],
        teacher: row['입력 교사명'],
        notes: row['특이사항'],
        antecedent: row['주요선행사건'],
        consequence: row['주요후속결과'],
        week: row['발생 주차']
      }));

      // Load praise points
      SWPBS.data.praisePoints = dataset.praiseData;

      // Load CICO records
      SWPBS.data.cicoRecords = dataset.cicoData;

      // Load FBA assessments
      SWPBS.data.fbaAssessments = dataset.fbaData;

      // Load BIP plans
      SWPBS.data.bipPlans = dataset.bipData;

      // Load meetings
      SWPBS.data.meetings = dataset.meetingData;

      // Extract unique students
      const studentNames = [...new Set(dataset.odrData.map(row => row['학생명']))];
      SWPBS.data.students = studentNames.map(name => {
        const studentEvents = SWPBS.data.odrEvents.filter(e => e.studentName === name);
        const avgIntensity = studentEvents.length > 0
          ? studentEvents.reduce((sum, e) => sum + e.intensity, 0) / studentEvents.length
          : 0;

        let tier = 'Tier 1';
        if (avgIntensity >= 4 || studentEvents.length >= 8) tier = 'Tier 3';
        else if (avgIntensity >= 3 || studentEvents.length >= 4) tier = 'Tier 2';

        // Check if student has CICO or BIP
        const hasCICO = SWPBS.data.cicoRecords.some(r => r.studentName === name);
        const hasBIP = SWPBS.data.bipPlans.some(b => b.studentName === name);
        const hasFBA = SWPBS.data.fbaAssessments.some(f => f.studentName === name);

        const interventions = [];
        if (hasCICO) interventions.push('CICO');
        if (hasFBA) interventions.push('FBA');
        if (hasBIP) interventions.push('BIP');

        return {
          id: `student_${name}`,
          name: name,
          grade: Math.floor(Math.random() * 6) + 1,
          class: Math.floor(Math.random() * 4) + 1,
          tier: tier,
          odrCount: studentEvents.length,
          lastODR: studentEvents[0]?.date || '',
          status: 'active',
          interventions: interventions
        };
      });

      // Initialize TFI scores
      SWPBS.data.tfiScores = {
        tier1: {
          teams: 85,
          implementation: 80,
          evaluation: 75,
          total: 80
        },
        tier2: {
          teams: 70,
          implementation: 65,
          evaluation: 60,
          total: 65
        },
        tier3: {
          teams: 60,
          implementation: 55,
          evaluation: 50,
          total: 55
        }
      };

      // Initialize SAS scores
      SWPBS.data.sasScores = {
        expectations: 4.2,
        training: 3.8,
        monitoring: 4.0,
        recognition: 4.5,
        discipline: 3.9,
        overall: 4.08
      };

      // Save to localStorage
      DataManager.saveToLocalStorage();

      // Update dashboard
      UIManager.updateDashboard();

      console.log('✅ Sample data loaded successfully');
    }

    // Global helper functions for quick actions
    function recordODR() {
      showModule('tier1');
      // Auto-click the data tab after a short delay
      setTimeout(() => {
        const dataTab = document.querySelector('[data-tier1-tab="data"]');
        if (dataTab) dataTab.click();
      }, 300);
    }

    function recordPraise() {
      showModule('tier1');
      setTimeout(() => {
        const rewardsTab = document.querySelector('[data-tier1-tab="rewards"]');
        if (rewardsTab) rewardsTab.click();
      }, 300);
    }

    function generateReport() {
      showModule('datacenter');
      setTimeout(() => {
        const reportsTab = document.querySelector('[data-datacenter-tab="reports"]');
        if (reportsTab) reportsTab.click();
      }, 300);
    }

    // Update showModule to render module content
    function showModule(moduleId) {
      console.log('🔄 Switching to module:', moduleId);

      // Hide all modules
      document.querySelectorAll('.module-section').forEach(section => {
        section.classList.remove('active');
      });

      // Show selected module
      const moduleSection = document.getElementById(moduleId);
      if (!moduleSection) {
        console.error('❌ Module section not found:', moduleId);
        return;
      }

      moduleSection.classList.add('active');

      // Render module content
      try {
        switch(moduleId) {
          case 'tier1':
            if (typeof Tier1Module === 'undefined') {
              throw new Error('Tier1Module not loaded');
            }
            moduleSection.innerHTML = Tier1Module.render();
            Tier1Module.initializeCharts();
            Tier1Module.attachEventListeners();
            console.log('✅ Tier 1 module rendered');
            break;

          case 'tier2':
            if (typeof Tier2Module === 'undefined') {
              throw new Error('Tier2Module not loaded');
            }
            moduleSection.innerHTML = Tier2Module.render();
            Tier2Module.initializeCharts();
            Tier2Module.attachEventListeners();
            console.log('✅ Tier 2 module rendered');
            break;

          case 'tier3':
            if (typeof Tier3Module === 'undefined') {
              throw new Error('Tier3Module not loaded');
            }
            moduleSection.innerHTML = Tier3Module.render();
            Tier3Module.initializeCharts();
            Tier3Module.attachEventListeners();
            console.log('✅ Tier 3 module rendered');
            break;

          case 'datacenter':
            if (typeof DataCenterModule === 'undefined') {
              throw new Error('DataCenterModule not loaded');
            }
            moduleSection.innerHTML = DataCenterModule.render();
            DataCenterModule.attachEventListeners();
            console.log('✅ DataCenter module rendered');
            break;

          case 'meetings':
            if (typeof MeetingsModule === 'undefined') {
              throw new Error('MeetingsModule not loaded');
            }
            moduleSection.innerHTML = MeetingsModule.render();
            MeetingsModule.initializeCharts();
            MeetingsModule.attachEventListeners();
            console.log('✅ Meetings module rendered');
            break;

          case 'help':
            moduleSection.innerHTML = renderHelpModule();
            console.log('✅ Help module rendered');
            break;

          case 'home':
            console.log('✅ Home module (already rendered)');
            break;

          default:
            console.warn('⚠️ Unknown module:', moduleId);
        }
      } catch (error) {
        console.error('❌ Error rendering module:', moduleId, error);
        moduleSection.innerHTML = `
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">⚠️ 모듈 로드 오류</h3>
            </div>
            <div class="card-body">
              <div class="alert alert-danger">
                <span>❌</span>
                <div>
                  <strong>모듈을 불러올 수 없습니다:</strong> ${moduleId}<br>
                  <small>오류: ${error.message}</small><br>
                  <small>페이지를 새로고침(F5)해보세요.</small>
                </div>
              </div>
            </div>
          </div>
        `;
      }

      // Update header nav
      document.querySelectorAll('.header-nav-item').forEach(item => {
        item.classList.remove('active');
      });

      // Update UI state if SWPBS is available
      if (typeof SWPBS !== 'undefined') {
        SWPBS.ui.currentModule = moduleId;
      }
    }

    // Update selectRole function
    function selectRole(role) {
      SWPBS.user.role = role;

      // Update role buttons
      document.querySelectorAll('.role-button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.role === role) {
          btn.classList.add('active');
        }
      });

      // Set permissions based on role
      const permissions = {
        admin: ['all'],
        leadership: ['tier1', 'tier2', 'tier3', 'meetings', 'datacenter'],
        tier2: ['tier1', 'tier2', 'datacenter'],
        tier3: ['tier1', 'tier3', 'datacenter'],
        teacher: ['tier1', 'datacenter'],
        manager: ['datacenter', 'meetings']
      };

      SWPBS.user.permissions = permissions[role] || [];

      // Show notification
      UIManager.showNotification(`${getRoleName(role)} 역할로 전환되었습니다`, 'success');
    }

    function getRoleName(role) {
      const roleNames = {
        admin: '총괄담당',
        leadership: '리더십팀원',
        tier2: '표적집단 담당',
        tier3: '개별지원 담당',
        teacher: '담임교사',
        manager: '관리자'
      };
      return roleNames[role] || role;
    }

    // Help module content
    function renderHelpModule() {
      return `
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">❓ 사용자 가이드</h2>
          </div>
          <div class="card-body">
            <div class="grid grid-2">
              <div>
                <h3>시작하기</h3>
                <ul class="feature-list">
                  <li><strong>역할 선택:</strong> 상단의 역할 버튼을 클릭하여 귀하의 역할을 선택하세요</li>
                  <li><strong>데이터 업로드:</strong> 데이터센터에서 CSV 파일을 업로드하세요</li>
                  <li><strong>ODR 기록:</strong> Tier 1 모듈에서 문제행동 사건을 기록하세요</li>
                  <li><strong>학생 배치:</strong> Tier 2/3 모듈에서 개입 프로그램에 학생을 배치하세요</li>
                </ul>

                <h3 class="mt-4">주요 기능</h3>
                <ul class="feature-list">
                  <li><strong>Tier 1:</strong> 보편적 지원 - 기대행동, ODR 관리, 칭찬 포인트</li>
                  <li><strong>Tier 2:</strong> 표적집단 - CICO, SST, FCT 프로그램</li>
                  <li><strong>Tier 3:</strong> 개별지원 - FBA 평가, BIP 계획, 위기관리</li>
                  <li><strong>데이터센터:</strong> CSV 업로드, 쿼리 빌더, 보고서 생성</li>
                  <li><strong>회의:</strong> 리더십 미팅, TFI 평가, 실행과제 추적</li>
                </ul>
              </div>

              <div>
                <h3>CSV 파일 형식</h3>
                <p>다음 컬럼을 포함한 CSV 파일을 업로드하세요:</p>
                <ul class="feature-list">
                  <li>행동 발생일 (YYYY-MM-DD)</li>
                  <li>발생 시간대 (오전/오후)</li>
                  <li>학생명</li>
                  <li>발생한 위기행동</li>
                  <li>강도or5점 척도 (1-5)</li>
                  <li>추정되는 기능(동기)</li>
                  <li>행동 발생 장소</li>
                  <li>현재지원단계 (Tier 1/2/3)</li>
                  <li>기타 선택 필드</li>
                </ul>

                <h3 class="mt-4">자주 묻는 질문</h3>
                <div class="alert alert-info">
                  <strong>Q: 데이터는 어디에 저장되나요?</strong><br>
                  A: 모든 데이터는 브라우저의 localStorage에 안전하게 저장됩니다.
                </div>

                <div class="alert alert-info">
                  <strong>Q: TFI 점수는 어떻게 계산하나요?</strong><br>
                  A: 회의 모듈의 TFI 탭에서 각 항목을 평가하면 자동으로 계산됩니다.
                </div>

                <div class="alert alert-info">
                  <strong>Q: 학생은 언제 Tier 2/3로 배치하나요?</strong><br>
                  A: ODR 빈도와 강도를 기준으로 자동 추천되며, 팀 회의에서 최종 결정합니다.
                </div>
              </div>
            </div>

            <div class="mt-4" style="text-align: center; padding: var(--space-5); background: var(--background); border-radius: var(--radius-lg);">
              <h3>기술 지원</h3>
              <p>문의사항이 있으시면 swpbs-support@school.edu로 연락주세요</p>
              <button class="btn btn-primary mt-3" onclick="window.open('https://github.com', '_blank')">
                📚 전체 사용자 매뉴얼 보기
              </button>
            </div>
          </div>
        </div>
      `;
    }
  </script>
</body>
</html>
